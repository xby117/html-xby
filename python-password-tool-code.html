<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TECH·G | 密码生成与管理工具 - 示例代码</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        html, body { height: 100%; overflow-x: hidden; background: #000; color: #f5f5f5; }
        
        /* 返回按钮 */
        .back-container { padding: clamp(20px, 4vw, 24px) clamp(16px, 5vw, 40px); text-align: left; }
        .back-btn { 
            padding: clamp(6px, 1.5vw, 8px) clamp(16px, 2vw, 20px); 
            background: rgba(249, 115, 22, 0.1); color: #f97316; 
            text-decoration: none; border-radius: 4px; transition: all 0.3s ease; 
            font-size: clamp(12px, 1.8vw, 14px); display: inline-block; 
        }
        .back-btn:hover { background: rgba(249, 115, 22, 0.2); transform: translateY(-2px); }
        
        /* 代码区域 */
        .code-section { 
            width: 100%; padding: clamp(20px, 5vw, 40px) clamp(16px, 5vw, 40px); 
            max-width: 1200px; margin: 0 auto; min-height: calc(100vh - 120px); 
        }
        .code-title { 
            font-size: clamp(18px, 3vw, 22px); color: #fff; margin-bottom: clamp(20px, 4vw, 30px); 
            position: relative; display: inline-block; 
        }
        .code-title::after { 
            content: ''; display: block; width: clamp(50px, 10vw, 50px); height: 2px; 
            background: #22c55e; margin: 8px 0 0; 
        }
        .code-description { 
            font-size: clamp(13px, 2vw, 15px); color: #aaa; line-height: 1.6; 
            margin-bottom: clamp(20px, 3vw, 24px); 
        }
        .code-card { 
            background: #0a0a0a; border-radius: 8px; padding: clamp(20px, 3vw, 24px); 
            position: relative; border: 1px solid rgba(34, 197, 94, 0.1); 
        }
        .copy-btn { 
            position: absolute; top: clamp(16px, 2vw, 20px); right: clamp(16px, 2vw, 20px); 
            padding: clamp(4px, 1vw, 6px) clamp(12px, 1.5vw, 16px); 
            background: rgba(34, 197, 94, 0.1); color: #22c55e; 
            border: none; border-radius: 4px; font-size: clamp(11px, 1.5vw, 12px); 
            cursor: pointer; transition: all 0.3s ease; 
        }
        .copy-btn:hover { background: rgba(34, 197, 94, 0.2); }
        .copy-success { 
            position: absolute; top: clamp(16px, 2vw, 20px); right: clamp(100px, 10vw, 120px); 
            color: #22c55e; font-size: clamp(11px, 1.5vw, 12px); display: none; 
        }
        pre { 
            white-space: pre-wrap; word-break: break-all; overflow-x: auto; 
            font-size: clamp(12px, 1.8vw, 14px); line-height: 1.6; 
        }
        code { color: #d1d5db; }
        .keyword { color: #c084fc; }
        .string { color: #facc15; }
        .comment { color: #6b7280; }
        .function { color: #38bdf8; }
        .variable { color: #a78bfa; }
        .number { color: #f87171; }
        
        /* 页脚 */
        .footer { 
            width: 100%; padding: clamp(16px, 3vw, 20px) 0; 
            text-align: center; color: #888; font-size: clamp(11px, 2vw, 12px); 
            background: rgba(0, 0, 0, 0.9); border-top: 1px solid rgba(34, 197, 94, 0.1);
        }
    </style>
</head>
<body>
    <div class="back-container">
        <a href="python-password-tool.html" class="back-btn">返回功能详情</a>
    </div>

    <section class="code-section">
        <h1 class="code-title">密码生成与管理工具 - 核心示例代码</h1>
        <p class="code-description">以下是支持高强度密码生成、AES 加密存储和主密码验证的核心代码，保障密码安全：</p>
        
        <div class="code-card">
            <button class="copy-btn" onclick="copyCode(this)">复制代码</button>
            <span class="copy-success">复制成功！</span>
            <pre><code><span class="keyword">import</span> random
<span class="keyword">import</span> string
<span class="keyword">import</span> json
<span class="keyword">import</span> os
<span class="keyword">import</span> hashlib
<span class="keyword">import</span> pyperclip
<span class="keyword">from</span> cryptography.fernet <span class="keyword">import</span> Fernet
<span class="keyword">from</span> cryptography.hazmat.primitives.kdf.pbkdf2 <span class="keyword">import</span> PBKDF2HMAC
<span class="keyword">from</span> cryptography.hazmat.primitives <span class="keyword">import</span> hashes
<span class="keyword">import</span> base64
<span class="keyword">import</span> getpass

<span class="comment"># 配置文件路径</span>
PASSWORD_DB_PATH = <span class="string">'passwords.db'</span>
SALT_PATH = <span class="string">'salt.bin'</span>

<span class="comment"># 生成或加载盐值（用于主密码加密）</span>
<span class="keyword">def</span> <span class="function">get_or_generate_salt</span>():
    <span class="keyword">if</span> os.path.exists(SALT_PATH):
        <span class="keyword">with</span> open(SALT_PATH, <span class="string">'rb'</span>) <span class="keyword">as</span> f:
            <span class="keyword">return</span> f.read()
    <span class="keyword">else</span>:
        salt = os.urandom(<span class="number">16</span>)
        <span class="keyword">with</span> open(SALT_PATH, <span class="string">'wb'</span>) <span class="keyword">as</span> f:
            f.write(salt)
        <span class="keyword">return</span> salt

<span class="comment"># 基于主密码生成加密密钥</span>
<span class="keyword">def</span> <span class="function">generate_key_from_master_password</span>(master_password, salt):
    kdf = PBKDF2HMAC(
        algorithm=hashes.SHA256(),
        length=<span class="number">32</span>,
        salt=salt,
        iterations=<span class="number">100000</span>,
    )
    key = base64.urlsafe_b64encode(kdf.derive(master_password.encode(<span class="string">'utf-8'</span>)))
    <span class="keyword">return</span> Fernet(key)

<span class="comment"># 验证主密码</span>
<span class="keyword">def</span> <span class="function">verify_master_password</span>(input_password, stored_hash, salt):
    derived_key = hashlib.pbkdf2_hmac(
        <span class="string">'sha256'</span>,
        input_password.encode(<span class="string">'utf-8'</span>),
        salt,
        <span class="number">100000</span>
    )
    <span class="keyword">return</span> derived_key == stored_hash

<span class="comment"># 初始化密码数据库（存储主密码哈希和加密后的密码数据）</span>
<span class="keyword">def</span> <span class="function">initialize_password_db</span>(master_password):
    salt = get_or_generate_salt()
    <span class="comment"># 生成主密码哈希（用于验证）</span>
    master_hash = hashlib.pbkdf2_hmac(
        <span class="string">'sha256'</span>,
        master_password.encode(<span class="string">'utf-8'</span>),
        salt,
        <span class="number">100000</span>
    )
    <span class="comment"># 初始化数据库结构</span>
    db_data = {
        <span class="string">'master_hash'</span>: base64.b64encode(master_hash).decode(<span class="string">'utf-8'</span>),
        <span class="string">'passwords'</span>: []
    }
    <span class="keyword">with</span> open(PASSWORD_DB_PATH, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:
        json.dump(db_data, f, indent=<span class="number">2</span>)
    print(<span class="string">"密码数据库初始化成功！"</span>)

<span class="comment"># 生成高强度随机密码</span>
<span class="keyword">def</span> <span class="function">generate_strong_password</span>(length=<span class="number">16</span>, use_upper=<span class="keyword">True</span>, use_lower=<span class="keyword">True</span>, use_digits=<span class="keyword">True</span>, use_symbols=<span class="keyword">True</span>):
    <span class="comment"># 定义字符集</span>
    char_set = <span class="string">''</span>
    <span class="keyword">if</span> use_upper:
        char_set += string.ascii_uppercase
    <span class="keyword">if</span> use_lower:
        char_set += string.ascii_lowercase
    <span class="keyword">if</span> use_digits:
        char_set += string.digits
    <span class="keyword">if</span> use_symbols:
        char_set += <span class="string">'!@#$%^&*()_+-=[]{}|;:,.?~'</span>
    
    <span class="keyword">if</span> <span class="keyword">not</span> char_set:
        raise ValueError(<span class="string">"至少选择一种字符类型"</span>)
    
    <span class="comment"># 确保密码包含至少一种选中的字符类型</span>
    password = []
    <span class="keyword">if</span> use_upper:
        password.append(random.choice(string.ascii_uppercase))
    <span class="keyword">if</span> use_lower:
        password.append(random.choice(string.ascii_lowercase))
    <span class="keyword">if</span> use_digits:
        password.append(random.choice(string.digits))
    <span class="keyword">if</span> use_symbols:
        password.append(random.choice(<span class="string">'!@#$%^&*()_+-=[]{}|;:,.?~'</span>))
    
    <span class="comment"># 填充剩余长度</span>
    <span class="keyword">for</span> _ <span class="keyword">in</span> range(length - len(password)):
        password.append(random.choice(char_set))
    
    <span class="comment"># 打乱密码顺序</span>
    random.shuffle(password)
    <span class="keyword">return</span> <span class="string">''</span>.join(password)

<span class="comment"># 添加密码到数据库</span>
<span class="keyword">def</span> <span class="function">add_password</span>(fernet, platform, username, password, category=<span class="string">'other'</span>):
    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(PASSWORD_DB_PATH):
        raise FileNotFoundError(<span class="string">"密码数据库不存在，请先初始化"</span>)
    
    <span class="keyword">with</span> open(PASSWORD_DB_PATH, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:
        db_data = json.load(f)
    
    <span class="comment"># 加密密码</span>
    encrypted_password = fernet.encrypt(password.encode(<span class="string">'utf-8'</span>)).decode(<span class="string">'utf-8'</span>)
    
    <span class="comment"># 添加新密码条目</span>
    new_password = {
        <span class="string">'platform'</span>: platform,
        <span class="string">'username'</span>: username,
        <span class="string">'password'</span>: encrypted_password,
        <span class="string">'category'</span>: category,
        <span class="string">'created_at'</span>: os.path.getctime(PASSWORD_DB_PATH)
    }
    db_data[<span class="string">'passwords'</span>].append(new_password)
    
    <span class="keyword">with</span> open(PASSWORD_DB_PATH, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:
        json.dump(db_data, f, indent=<span class="number">2</span>)
    print(<span class="string">f"成功添加 {platform} 的密码！"</span>)

<span class="comment"># 查找密码（支持模糊搜索）</span>
<span class="keyword">def</span> <span class="function">search_password</span>(fernet, keyword):
    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(PASSWORD_DB_PATH):
        raise FileNotFoundError(<span class="string">"密码数据库不存在，请先初始化"</span>)
    
    <span class="keyword">with</span> open(PASSWORD_DB_PATH, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:
        db_data = json.load(f)
    
    results = []
    <span class="keyword">for</span> item <span class="keyword">in</span> db_data[<span class="string">'passwords'</span>]:
        <span class="keyword">if</span> keyword.lower() <span class="keyword">in</span> item[<span class="string">'platform'</span>].lower() <span class="keyword">or</span> keyword.lower() <span class="keyword">in</span> item[<span class="string">'username'</span>].lower():
            <span class="comment"># 解密密码</span>
            decrypted_password = fernet.decrypt(item[<span class="string">'password'</span>].encode(<span class="string">'utf-8'</span>)).decode(<span class="string">'utf-8'</span>)
            results.append({
                <span class="string">'platform'</span>: item[<span class="string">'platform'</span>],
                <span class="string">'username'</span>: item[<span class="string">'username'</span>],
                <span class="string">'password'</span>: decrypted_password,
                <span class="string">'category'</span>: item[<span class="string">'category'</span>]
            })
    <span class="keyword">return</span> results

<span class="comment"># 复制密码到剪贴板</span>
<span class="keyword">def</span> <span class="function">copy_to_clipboard</span>(password):
    pyperclip.copy(password)
    print(<span class="string">"密码已复制到剪贴板！"</span>)

<span class="comment"># 密码强度检测</span>
<span class="keyword">def</span> <span class="function">check_password_strength</span>(password):
    strength = <span class="number">0</span>
    feedback = []
    
    <span class="comment"># 长度检测</span>
    <span class="keyword">if</span> len(password) >= <span class="number">12</span>:
        strength += <span class="number">2</span>
    elif len(password) >= <span class="number">8</span>:
        strength += <span class="number">1</span>
    <span class="keyword">else</span>:
        feedback.append(<span class="string">"密码长度应至少8位"</span>)
    
    <span class="comment"># 字符类型检测</span>
    <span class="keyword">if</span> any(c.isupper() <span class="keyword">for</span> c <span class="keyword">in</span> password):
        strength += <span class="number">1</span>
    <span class="keyword">else</span>:
        feedback.append(<span class="string">"缺少大写字母"</span>)
    
    <span class="keyword">if</span> any(c.islower() <span class="keyword">for</span> c <span class="keyword">in</span> password):
        strength += <span class="number">1</span>
    <span class="keyword">else</span>:
        feedback.append(<span class="string">"缺少小写字母"</span>)
    
    <span class="keyword">if</span> any(c.isdigit() <span class="keyword">for</span> c <span class="keyword">in</span> password):
        strength += <span class="number">1</span>
    <span class="keyword">else</span>:
        feedback.append(<span class="string">"缺少数字"</span>)
    
    <span class="keyword">if</span> any(c <span class="keyword">in</span> <span class="string">'!@#$%^&*()_+-=[]{}|;:,.?~'</span> <span class="keyword">for</span> c <span class="keyword">in</span> password):
        strength += <span class="number">1</span>
    <span class="keyword">else</span>:
        feedback.append(<span class="string">"缺少特殊字符"</span>)
    
    <span class="comment"># 强度评级</span>
    <span class="keyword">if</span> strength >= <span class="number">6</span>:
        level = <span class="string">"极强"</span>
    elif strength >= <span class="number">4</span>:
        level = <span class="string">"强"</span>
    elif strength >= <span class="number">2</span>:
        level = <span class="string">"中等"</span>
    <span class="keyword">else</span>:
        level = <span class="string">"弱"</span>
    
    <span class="keyword">return</span> {<span class="string">'level'</span>: level, <span class="string">'feedback'</span>: feedback}

<span class="comment"># 主交互逻辑</span>
<span class="keyword">def</span> <span class="function">main</span>():
    salt = get_or_generate_salt()
    fernet = <span class="keyword">None</span>
    
    <span class="comment"># 检查数据库是否存在</span>
    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(PASSWORD_DB_PATH):
        print(<span class="string">"未检测到密码数据库，进行初始化..."</span>)
        master_password = getpass.getpass(<span class="string">"设置主密码："</span>)
        confirm_password = getpass.getpass(<span class="string">"确认主密码："</span>)
        <span class="keyword">if</span> master_password != confirm_password:
            print(<span class="string">"两次密码不一致！"</span>)
            <span class="keyword">return</span>
        initialize_password_db(master_password)
        fernet = generate_key_from_master_password(master_password, salt)
    <span class="keyword">else</span>:
        <span class="comment"># 验证主密码</span>
        <span class="keyword">with</span> open(PASSWORD_DB_PATH, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:
            db_data = json.load(f)
        stored_hash = base64.b64decode(db_data[<span class="string">'master_hash'</span>])
        
        master_password = getpass.getpass(<span class="string">"请输入主密码："</span>)
        <span class="keyword">if</span> <span class="keyword">not</span> verify_master_password(master_password, stored_hash, salt):
            print(<span class="string">"主密码错误！"</span>)
            <span class="keyword">return</span>
        fernet = generate_key_from_master_password(master_password, salt)
    
    <span class="comment"># 功能菜单</span>
    <span class="keyword">while</span> <span class="keyword">True</span>:
        print(<span class="string">"\n===== 密码管理工具 ====="</span>)
        print(<span class="string">"1. 生成随机密码"</span>)
        print(<span class="string">"2. 添加密码"</span>)
        print(<span class="string">"3. 搜索密码"</span>)
        print(<span class="string">"4. 检测密码强度"</span>)
        print(<span class="string">"5. 退出"</span>)
        
        choice = input(<span class="string">"请选择功能（1-5）："</span>)
        <span class="keyword">if</span> choice == <span class="string">'1'</span>:
            <span class="comment"># 生成密码</span>
            length = int(input(<span class="string">"密码长度（默认16位）："</span>) <span class="keyword">or</span> <span class="string">'16'</span>)
            password = generate_strong_password(length=length)
            print(<span class="string">f"生成的密码：{password}"</span>)
            <span class="keyword">if</span> input(<span class="string">"是否复制到剪贴板？(y/n)："</span>).lower() == <span class="string">'y'</span>:
                copy_to_clipboard(password)
        elif choice == <span class="string">'2'</span>:
            <span class="comment"># 添加密码</span>
            platform = input(<span class="string">"平台名称（如：微信）："</span>)
            username = input(<span class="string">"账号/用户名："</span>)
            password = input(<span class="string">"密码（直接输入或按回车生成）："</span>)
            <span class="keyword">if</span> <span class="keyword">not</span> password:
                password = generate_strong_password()
                print(<span class="string">f"自动生成密码：{password}"</span>)
            category = input(<span class="string">"分类（默认other）："</span>) <span class="keyword">or</span> <span class="string">'other'</span>
            add_password(fernet, platform, username, password, category)
        elif choice == <span class="string">'3'</span>:
            <span class="comment"># 搜索密码</span>
            keyword = input(<span class="string">"请输入搜索关键词（平台/账号）："</span>)
            results = search_password(fernet, keyword)
            <span class="keyword">if</span> results:
                print(<span class="string">f"\n找到 {len(results)} 条结果："</span>)
                <span class="keyword">for</span> i, res <span class="keyword">in</span> enumerate(results, <span class="number">1</span>):
                    print(<span class="string">f"{i}. 平台：{res['platform']}"</span>)
                    print(<span class="string">f"   账号：{res['username']}"</span>)
                    print(<span class="string">f"   密码：{res['password']}"</span>)
                    print(<span class="string">f"   分类：{res['category']}"</span>)
                    <span class="keyword">if</span> input(<span class="string">"是否复制该密码？(y/n)："</span>).lower() == <span class="string">'y'</span>:
                        copy_to_clipboard(res['password'])
                        <span class="keyword">break</span>
            <span class="keyword">else</span>:
                print(<span class="string">"未找到匹配结果"</span>)
        elif choice == <span class="string">'4'</span>:
            <span class="comment"># 检测密码强度</span>
            password = input(<span class="string">"请输入要检测的密码："</span>)
            result = check_password_strength(password)
            print(<span class="string">f"密码强度：{result['level']}"</span>)
            <span class="keyword">if</span> result['feedback']:
                print(<span class="string">"优化建议："</span>)
                <span class="keyword">for</span> msg <span class="keyword">in</span> result['feedback']:
                    print(<span class="string">f"- {msg}"</span>)
        elif choice == <span class="string">'5'</span>:
            print(<span class="string">"退出工具，感谢使用！"</span>)
            <span class="keyword">break</span>
        <span class="keyword">else</span>:
            print(<span class="string">"无效选择，请重新输入！"</span>)

<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    main()</code></pre>
        </div>
    </section>

    <footer class="footer">
        <p>© 2025 TECH·G | 极简黑绿科技风</p>
    </footer>

    <script>
        // 复制代码功能
        function copyCode(btn) {
            const pre = btn.nextElementSibling.nextElementSibling;
            const code = pre.textContent;
            navigator.clipboard.writeText(code).then(() => {
                const successMsg = btn.nextElementSibling;
                successMsg.style.display = 'inline-block';
                setTimeout(() => {
                    successMsg.style.display = 'none';
                }, 2000);
            });
        }
    </script>
</body>
</html>
